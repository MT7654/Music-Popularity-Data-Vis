<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Upcoming Artists — Scatter (Styled)</title>
  <!-- D3 v7 for promise-based csv loading -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    /* ====== Copied styling from index.html ====== */
    body {font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin:0; padding:0; background-color:#f8fafc; color:#333;}
    .navbar {background-color:#4f46e5; box-shadow:0 2px 10px rgba(0,0,0,0.1); position:sticky; top:0; z-index:1000;}
    .nav-container {max-width:1200px; margin:0 auto; padding:0 20px;}
    .nav-tabs {display:flex; list-style:none; margin:0; padding:0; overflow-x:auto;}
    .nav-tab {flex:0 0 auto;}
    .nav-link {display:block; padding:16px 20px; color:rgba(255,255,255,0.8); text-decoration:none; font-weight:500; border-bottom:3px solid transparent; transition:all 0.3s ease; white-space:nowrap;}
    .nav-link:hover {color:#fff; background-color:rgba(255,255,255,0.1);} 
    .nav-link.active {color:#fff; border-bottom-color:#fff; background-color:rgba(255,255,255,0.1);} 
    .content {max-width:1200px; margin:40px auto; padding:0 20px;}
    .card {background:#fff; border-radius:12px; box-shadow:0 4px 15px rgba(0,0,0,0.08); padding:25px;}
    .card h2 {margin:0 0 12px 0; color:#4f46e5;}
    .hint {color:#666; font-size:14px;}
    /* Responsive */
    @media (max-width:768px){ .nav-tabs{justify-content:flex-start;} }

    /* ====== Chart styles ====== */
    #chartWrap {width:100%;}
    svg {background:#fff; border:1px solid #e5e7eb; border-radius:12px;}
    .axis path, .axis line {stroke:#9ca3af; shape-rendering:crispEdges;}
    .dot {fill:#69b3a2; fill-opacity:.8; stroke:#256353; stroke-width:0.5px;}
    .dot:hover {fill:#ff7f0e;}
    .tooltip {position:fixed; pointer-events:none; background:#111827; color:#fff; padding:8px 10px; border-radius:8px; font-size:12px; display:none; box-shadow:0 8px 20px rgba(0,0,0,.25);} 
    .error {text-align:center; color:#b91c1c; padding:12px;}
  </style>
</head>
<body>
  <!-- Navigation Bar -->
  <nav class="navbar">
    <div class="nav-container">
      <ul class="nav-tabs">
        <li class="nav-tab"><a href="index.html" class="nav-link">Dashboard</a></li>
        <li class="nav-tab"><a href="section2.html" class="nav-link">Vibe Trends Over Time</a></li>
        <li class="nav-tab"><a href="Section4.html" class="nav-link">Global Vibe Trends</a></li>
        <li class="nav-tab"><a href="slide1_todays_hits_onepage.html" class="nav-link">Today's Hits</a></li>
        <li class="nav-tab"><a href="upcoming_artists_quadrant_report.html" class="nav-link">Upcoming Artists</a></li>
        <li class="nav-tab"><a href="vibe_recommendations_dashboard.html" class="nav-link">Vibe Recommendations</a></li>
      </ul>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="content">
    <div class="card">
      <h2>Momentum vs Popularity</h2>
      <div class="hint">Loads <code>spotify_quadrant_points_top200_by_day.csv</code> automatically. X: Momentum (higher = improving), Y: Popularity (median rank, lower is better).</div>
      <div id="chartWrap"></div>
      <div id="summaryBox" class="card" style="margin-top:20px; background:#f9fafb; border:1px solid #e5e7eb;">
        <h3 style="color:#4f46e5; margin-top:0;">Understanding the Scatterplot</h3>
        <p style="color:#555; line-height:1.6;">
          Each point on the scatterplot represents an <strong>artist</strong>. The horizontal axis shows the artist’s <strong>momentum</strong>, meaning how much their rank has improved over time (a higher value means faster growth or rising popularity). The vertical axis reflects <strong>popularity</strong> — measured as the median chart rank, so <em>lower</em> positions (toward the bottom) indicate stronger mainstream presence. 
        </p>
        <p style="color:#555; line-height:1.6;">
          Artists that appear toward the <strong>bottom-right</strong> are those who are <strong>both popular and gaining momentum</strong>, often seen as breakout stars. Those on the <strong>top-right</strong> are rapidly improving but not yet mainstream, representing <em>emerging talent with strong potential</em>. The <strong>top-left</strong> quadrant usually reflects artists with low momentum and limited exposure, while the <strong>bottom-left</strong> indicates stable but established acts with slower current growth. 
        </p>
        <p style="color:#555; line-height:1.6;">
          In short, this chart helps identify who’s trending upward, who’s already famous, and who might be fading — providing a visual map of potential rising stars in the music landscape.
        </p>
      </div>
      <div id="errorBox" class="error" style="display:none"></div>
    </div>
  </div>

  <div id="tooltip" class="tooltip"></div>

  <script>
    // ===== Config =====
    const CSV_PATH = 'spotify_quadrant_points_top200_by_day.csv';

    // Size
    const margin = {top: 20, right: 20, bottom: 50, left: 70};
    const fullW = Math.min(1180, window.innerWidth - 40);
    const fullH = Math.max(420, Math.round(window.innerHeight * 0.6));
    const width = fullW - margin.left - margin.right;
    const height = fullH - margin.top - margin.bottom;

    const wrap = d3.select('#chartWrap');
    const svg = wrap.append('svg')
      .attr('width', width + margin.left + margin.right)
      .attr('height', height + margin.top + margin.bottom)
      .append('g')
      .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');

    const tooltip = d3.select('#tooltip');
    const errorBox = d3.select('#errorBox');

    function normalizeKey(s){ return String(s||'').toLowerCase().replace(/[^a-z0-9]/g,''); }
    function guessColumn(columns, candidates){
      const map = new Map(columns.map(c => [normalizeKey(c), c]));
      for(const names of candidates){
        for(const n of names){ const hit = map.get(normalizeKey(n)); if(hit) return hit; }
      }
      return null;
    }

    function computeFromRows(raw){
      // Try direct columns first (already aggregated)
      const cols = Object.keys(raw[0]||{});
      const lc = cols.map(c=>c.toLowerCase());
      const artistCol = guessColumn(cols, [["artist","artist_name","singer"],["name"]]) || cols[0];
      const momentumCol = guessColumn(cols, [["momentum","mom"],["avgmovement","delta"]]);
      const popularityCol = guessColumn(cols, [["popularity","medianrank","rankmedian"],["rank","chart_rank"]]);

      if (momentumCol && popularityCol){
        const rows = raw.map(d=>({
          artist: d[artistCol],
          momentum: +d[momentumCol],
          popularity: +d[popularityCol]
        })).filter(d=> Number.isFinite(d.momentum) && Number.isFinite(d.popularity));
        return rows;
      }

      // Else compute from time-series ranks per artist
      const dateCol = guessColumn(cols, [["date","ds","day","timestamp"]]);
      const rankCol = guessColumn(cols, [["daily_rank","rank","position"],["chart_position","chart_rank"]]);
      if (!rankCol) throw new Error('Could not find rank column. Add a numeric "rank"/"daily_rank" column.');

      const rows = raw.map(d=>({
        artist: d[artistCol],
        rank: +d[rankCol],
        date: dateCol ? new Date(d[dateCol]) : null,
        t: dateCol ? +new Date(d[dateCol]) : 0
      })).filter(r => Number.isFinite(r.rank));

      const grouped = d3.group(rows, d=>d.artist);
      const out = [];
      grouped.forEach((vals, artist)=>{
        vals.sort((a,b)=> (a.t||0) - (b.t||0));
        if (vals.length < 5) return;
        const ranks = vals.map(v=>v.rank);
        const medianRank = d3.median(ranks);
        const momentum = ranks[0] - ranks[ranks.length-1];
        out.push({artist, momentum, popularity: medianRank});
      });
      return out;
    }

    function render(points){
      if (!points.length){ errorBox.style('display','block').text('No usable rows found in CSV.'); return; }
      // Scales
      const x = d3.scaleLinear().domain(d3.extent(points, d=>d.momentum)).nice().range([0, width]);
      const y = d3.scaleLinear().domain(d3.extent(points, d=>d.popularity)).nice().range([height, 0]);

      // Axes
      svg.append('g').attr('class','axis').attr('transform','translate(0,'+height+')').call(d3.axisBottom(x));
      svg.append('g').attr('class','axis').call(d3.axisLeft(y));

      // Labels
      svg.append('text').attr('x', width/2).attr('y', height+40).attr('text-anchor','middle').text('Momentum (higher = improving)');
      svg.append('text').attr('transform','rotate(-90)').attr('x', -height/2).attr('y', -50).attr('text-anchor','middle').text('Popularity (median rank, lower = better)');

      // Dots
      svg.append('g').selectAll('circle').data(points).enter().append('circle')
        .attr('class','dot')
        .attr('cx', d=> x(d.momentum))
        .attr('cy', d=> y(d.popularity))
        .attr('r', 4)
        .on('mousemove', (event,d)=>{
          tooltip.style('display','block').style('left', (event.clientX+12)+'px').style('top',(event.clientY-10)+'px')
                 .text(d.artist + ' • m=' + d3.format('.2f')(d.momentum) + ', pop=' + d3.format('.2f')(d.popularity));
        })
        .on('mouseleave', ()=> tooltip.style('display','none'));
    }

    // Load and draw
    d3.csv(CSV_PATH, d3.autoType).then(raw => {
      const points = computeFromRows(raw);
      render(points);
    }).catch(err => {
      errorBox.style('display','block').text('⚠️ Failed to load ' + CSV_PATH + ': ' + err.message + '\nTip: serve this folder over http:// (VS Code Live Server or python -m http.server).');
      console.error(err);
    });

    // Navbar active state
    document.addEventListener('DOMContentLoaded', function(){
      const currentPage = window.location.pathname.split('/').pop() || 'index.html';
      const navLinks = document.querySelectorAll('.nav-link');
      navLinks.forEach(link => { const href = link.getAttribute('href'); if(currentPage === href){ link.classList.add('active'); } });
    });
  </script>
</body>
</html>
